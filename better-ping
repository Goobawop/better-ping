#!/bin/bash

# Colors

RED='\e[31m'
GREEN='\e[92m'
MAGENTA='\e[95m'
NC='\e[0m'
WHITE='\e[97m'


# Cleanup function that will output the statistics of the ping command.

cleanup () {
        sleep 1
        echo
        grep -A 3 "ping" $HOME/logs/ping/$outputFile | cat
}


# Capture address to ping and echo results / Define file name.

ip=$1

echo -e $MAGENTA
echo "Enter a name for the generated log file:"
read fileName
outputFile=$(date +%Y-%m-%d_$fileName.txt)
echo -e $WHITE
echo "File to be generated: $HOME/logs/ping/$outputFile"
echo


# Ping address and write all lines to file, then read file back to user line-by-line.

ping -O $ip | while read -r line; do

        if [[ $line =~ PING ]] ; then
                echo -e $WHITE------------------------------------------------------------------------
                echo $line
                echo -e $NC------------------------------------------------------------------------
        elif [[ $line =~ ttl ]] ; then
                echo -e $GREEN$line
        elif [[ $line =~ ping ]] || [[ $line =~ rtt ]] || [[ $line =~ packet ]] ; then
                echo -e $WHITE$line
        else
                echo -e $RED$line

        fi >> $HOME/logs/ping/$outputFile

        tail -1 $HOME/logs/ping/$outputFile

        trap cleanup SIGINT
done
